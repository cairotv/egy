<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cinma Online | عالم السينما بين يديك</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #0b0b0b; color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .movie-card:hover .play-overlay { opacity: 1; }
        .gradient-bg { background: linear-gradient(0deg, rgba(11,11,11,1) 0%, rgba(11,11,11,0) 100%); }
    </style>
</head>
<body>

    <nav class="bg-black/90 sticky top-0 z-50 border-b border-red-600/30 p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold text-red-600 tracking-tighter">CINMA<span class="text-white underline">.ONLINE</span></h1>
            <div class="hidden md:flex space-x-6 space-x-reverse text-sm font-medium">
                <a href="#" onclick="loadCategory('أفلام أجنبي')" class="hover:text-red-500 transition">أفلام أجنبي</a>
                <a href="#" onclick="loadCategory('مسلسلات')" class="hover:text-red-500 transition">مسلسلات</a>
                <a href="#" onclick="loadCategory('نتفليكس')" class="hover:text-red-500 transition">نتفليكس</a>
            </div>
            <div class="relative">
                <input type="text" id="searchInput" placeholder="بحث عن فيلم..." class="bg-zinc-900 border border-zinc-700 rounded-full px-4 py-1 text-sm focus:outline-none focus:border-red-600 w-40 md:w-64">
            </div>
        </div>
    </nav>

    <main id="mainContent" class="container mx-auto p-4 min-h-screen">
        <div id="moviesGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
            </div>
    </main>

    <div id="movieModal" class="fixed inset-0 z-[60] hidden overflow-y-auto bg-black/95">
        <button onclick="closeModal()" class="fixed top-5 left-5 text-3xl z-[70] hover:text-red-600">&times;</button>
        <div id="modalContent"></div>
    </div>

    <script>
        const _supabase = supabase.createClient('YOUR_SUPABASE_URL', 'YOUR_SUPABASE_KEY');

        // جلب الأفلام من القاعدة اللي طورناها
        async function fetchMovies() {
            const { data, error } = await _supabase.from('movies').select('*').order('created_at', { ascending: false });
            if (data) displayMovies(data);
        }

        function displayMovies(movies) {
            const grid = document.getElementById('moviesGrid');
            grid.innerHTML = movies.map(movie => `
                <div class="movie-card relative group cursor-pointer" onclick="openMovie('${movie.id}')">
                    <img src="${movie.poster_path}" class="rounded-lg shadow-lg border border-zinc-800 transition transform group-hover:scale-105">
                    <div class="absolute top-2 right-2 bg-red-600 text-[10px] px-2 py-0.5 rounded">${movie.quality}</div>
                    <div class="absolute bottom-0 left-0 right-0 p-2 gradient-bg rounded-b-lg">
                        <p class="text-xs font-bold truncate">${movie.title}</p>
                        <p class="text-[10px] text-zinc-400">${new Date(movie.release_date).getFullYear()} • ⭐ ${movie.vote_average}</p>
                    </div>
                </div>
            `).join('');
        }

        // فتح صفحة الفيلم الاحترافية (زي عرب سيد)
        async function openMovie(id) {
            const { data: movie } = await _supabase.from('movies').select('*').eq('id', id).single();
            const modal = document.getElementById('movieModal');
            const content = document.getElementById('modalContent');

            content.innerHTML = `
                <div class="relative h-[60vh] bg-cover bg-center" style="background-image: url('${movie.backdrop_path}')">
                    <div class="absolute inset-0 bg-gradient-to-t from-[#0b0b0b] via-[#0b0b0b]/60 to-transparent"></div>
                </div>
                <div class="container mx-auto px-4 -mt-32 relative z-10">
                    <div class="flex flex-col md:flex-row gap-8">
                        <img src="${movie.poster_path}" class="w-64 rounded-xl shadow-2xl border-4 border-zinc-900 mx-auto md:mx-0">
                        <div class="flex-1 text-center md:text-right">
                            <h2 class="text-4xl font-bold mb-2">${movie.title}</h2>
                            <div class="flex flex-wrap justify-center md:justify-start gap-4 mb-6 text-sm text-zinc-300">
                                <span><i class="fas fa-calendar"></i> ${movie.release_date}</span>
                                <span><i class="fas fa-star text-yellow-500"></i> ${movie.vote_average}</span>
                                <span><i class="fas fa-eye"></i> ${movie.views_count} مشاهدة</span>
                            </div>
                            <p class="text-zinc-300 mb-8 leading-relaxed">${movie.description}</p>
                            
                            <div class="flex flex-wrap gap-4 justify-center md:justify-start mb-12">
                                <button class="bg-red-600 hover:bg-red-700 px-8 py-3 rounded-full font-bold transition"><i class="fas fa-play ml-2"></i> مشاهدة الآن</button>
                                <button class="bg-zinc-800 hover:bg-zinc-700 px-8 py-3 rounded-full font-bold transition"><i class="fas fa-download ml-2"></i> تحميل الفيلم</button>
                            </div>

                            <h3 class="text-xl font-bold mb-4 border-r-4 border-red-600 pr-3">فريق العمل</h3>
                            <div class="flex gap-4 overflow-x-auto pb-4">
                                ${movie.cast_data.map(c => `
                                    <div class="text-center min-w-[80px]">
                                        <img src="${c.image}" class="w-16 h-16 rounded-full object-cover border-2 border-zinc-700 mb-2">
                                        <p class="text-[10px] truncate w-20">${c.name}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('movieModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        fetchMovies();
    </script>
</body>
</html>
